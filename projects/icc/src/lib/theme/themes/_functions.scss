@import './mapping';

@function icc-add-theme($theme, $name) {
  $theme: map-merge($icc-mapping, $theme);
  $new: ($name: $theme);
  $icc-themes: map-merge($icc-themes, $new) !global;
  @return $icc-themes;
}

@function icc-theme($key) {
  $value: map-get($icc-current-theme, $key);
  @if ($value == null) {
    @warn 'Theme: icc-theme cannot find value for key `' + $key +'`';
  }
  @return $value;
}

@function icc-get-key-value($theme, $key, $value) {
  $parent: map-get($theme, $value);
  @if ($parent != null) {
    @return icc-get-key-value($theme, $value, $parent);
  }
  @return $value;
}

@function icc-get-current-theme($theme-name, $theme) {
  $current-theme: ();
  @each $key, $value in $theme {
    $new: ($key: icc-get-key-value($theme, $key, $value));
    $current-theme: map-merge($current-theme, $new);
  }
  @return $current-theme;
}

@mixin icc-setup-current-context($theme-name, $theme) {
  $icc-current-theme: icc-get-current-theme($theme-name, $theme) !global;
}

@mixin icc-setup-scss-vars() {
  @each $theme-name, $theme in $icc-themes {
    @include icc-setup-current-context($theme-name, $theme);
    .icc-theme-#{$theme-name} {
      @content;
    }
  }
}

@mixin icc-configure-theme() {
  @include icc-setup-scss-vars() {
    @content;
  }
}

// below is not used any more
@mixin themify($themes) {
  @each $theme, $map in $themes {
    .icc-theme-#{$theme} & {
      $theme-map: () !global;
      @each $key, $submap in $map {
        $value: map-get(map-get($themes, $theme), '#{$key}');
        $theme-map: map-merge($theme-map, ($key: $value)) !global;
      }
      @content;
      $theme-map: null !global;
    }
  }
}

@function themed($key) {
  @return map-get($theme-map, $key);
}
